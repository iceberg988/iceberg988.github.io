<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo/FlamingBytes-icon-64x64-1.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo/FlamingBytes-icon-64x64-1.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo/FlamingBytes-icon-64x64-1.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.flamingbytes.com","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Stay hungry, stay foolish">
<meta property="og:type" content="website">
<meta property="og:title" content="FlamingBytes">
<meta property="og:url" content="https://www.flamingbytes.com/page/16/index.html">
<meta property="og:site_name" content="FlamingBytes">
<meta property="og:description" content="Stay hungry, stay foolish">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="relentlesstorm">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.flamingbytes.com/page/16/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/16/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>FlamingBytes</title>
  







<!-- Google Adsense-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8578408127828851"
     crossorigin="anonymous"></script>

<!-- Google tag (gtag.js) for analytics-->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B8PQ47L2H0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B8PQ47L2H0');
</script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">FlamingBytes</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">10</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">106</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">281</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="relentlesstorm"
      src="/images/logo/FlamingBytes-icon-64x64-1.png">
  <p class="site-author-name" itemprop="name">relentlesstorm</p>
  <div class="site-description" itemprop="description">Stay hungry, stay foolish</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">281</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">106</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:relentlesstorm@gmail.com" title="E-Mail → mailto:relentlesstorm@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.flamingbytes.com/blog/getting-started-with-systemtap-for-linux-system-profiling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo/FlamingBytes-icon-64x64-1.png">
      <meta itemprop="name" content="relentlesstorm">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlamingBytes">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | FlamingBytes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/getting-started-with-systemtap-for-linux-system-profiling/" class="post-title-link" itemprop="url">Getting started with systemtap for Linux system profiling</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-15 07:00:00" itemprop="dateCreated datePublished" datetime="2022-07-15T07:00:00-07:00">2022-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-22 11:28:20" itemprop="dateModified" datetime="2023-10-22T11:28:20-07:00">2023-10-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/Performance/" itemprop="url" rel="index"><span itemprop="name">Performance</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Intro-to-SystemTap"><a href="#Intro-to-SystemTap" class="headerlink" title="Intro to SystemTap"></a>Intro to SystemTap</h2><p>SystemTap is a tracing and probing tool that allows users to study and monitor the activities of the operating system (particularly, the kernel) in fine detail. It provides information similar to the output of tools like netstat, ps, top, and iostat; however, SystemTap is designed to provide more filtering and analysis options for collected information.</p>
<p>SystemTap can be used by system administrators as a performance monitoring tool for Red Hat Enterprise Linux 5 or later. It is most useful when other similar tools cannot precisely pinpoint a bottleneck in the system, thus requiring a deep analysis of system activity. In the same manner, application developers can also use SystemTap to monitor, in fine detail, how their application behaves within the Linux system.</p>
<p>SystemTap was originally developed to provide functionality for Red Hat Enterprise Linux similar to previous Linux probing tools such as dprobes and the Linux Trace Toolkit. SystemTap aims to supplement the existing suite of Linux monitoring tools by providing users with the infrastructure to track kernel activity. In addition, SystemTap combines this capability with two attributes:</p>
<ul>
<li>Flexibility: SystemTap’s framework allows users to develop simple scripts for investigating and monitoring a wide variety of kernel functions, system calls, and other events that occur in kernel space. With this, SystemTap is not so much a tool as it is a system that allows you to develop your own kernel-specific forensic and monitoring tools.</li>
<li>Ease-of-Use: as mentioned earlier, SystemTap allows users to probe kernel-space events without having to resort to the lengthy instrument, recompile, install, and reboot the kernel process.</li>
</ul>
<h2 id="Understanding-how-SystemTap-works"><a href="#Understanding-how-SystemTap-works" class="headerlink" title="Understanding how SystemTap works"></a>Understanding how SystemTap works</h2><p>SystemTap allows users to write and reuse simple scripts to deeply examine the activities of a running Linux system. These scripts can be designed to extract data, filter it, and summarize it quickly (and safely), enabling the diagnosis of complex performance (or even functional) problems.</p>
<p>The essential idea behind a SystemTap script is to name events, and to give them handlers. When SystemTap runs the script, SystemTap monitors for the event; once the event occurs, the Linux kernel then runs the handler as a quick sub-routine and then resumes its normal operation.</p>
<p>There are several kinds of events; entering or exiting a function, timer expiration, session termination, etc. A handler is a series of script language statements that specify the work to be done whenever the event occurs. This work normally includes extracting data from the event context, storing them into internal variables, and printing results.</p>
<h2 id="Setting-up-SystemTap-and-its-required-kernel-packages"><a href="#Setting-up-SystemTap-and-its-required-kernel-packages" class="headerlink" title="Setting up SystemTap and its required kernel packages"></a>Setting up SystemTap and its required kernel packages</h2><p>To deploy SystemTap, SystemTap packages along with the corresponding set of -devel, -debuginfo and -debuginfo-common-arch packages for the kernel need to be installed. To use SystemTap on more than one kernel where a system has multiple kernels installed, install the -devel and -debuginfo packages for each of those kernel versions.</p>
<p>SystemTap needs information about the kernel in order to place instrumentation in it (probe it). This information, which allows SystemTap to generate the code for the instrumentation, is contained in the matching kernel-devel, kernel-debuginfo, and kernel-debuginfo-common-arch packages.</p>
<p>To install SystemTap packages:</p>
<pre><code>[root@host1 ~]# cat /etc/centos-release
CentOS Linux release 7.9.2009 (Core)
[root@host1 ~]# uname -r
3.10.0-1160.el7.x86_64

[root@host1 ~]# yum install -y systemtap systemtap-runtime

[root@host1 ~]# rpm -qa | grep systemtap
systemtap-runtime-4.0-13.el7.x86_64
systemtap-devel-4.0-13.el7.x86_64
systemtap-4.0-13.el7.x86_64
systemtap-client-4.0-13.el7.x86_64
</code></pre>
<p>To install devel and debuginfo packages in CentOS(set to enabled&#x3D;1):</p>
<pre><code>[root@host1 ~]# vim /etc/yum.repos.d/CentOS-Debuginfo.repo
[base-debuginfo]
name=CentOS-7 - Debuginfo
baseurl=http://debuginfo.centos.org/7/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-Debug-7
enabled=1

[root@host1 ~]# yum install -y kernel-devel-$(uname -r) \
&gt; kernel-debuginfo-$(uname -r) \
&gt; kernel-debuginfo-common-$(uname -m)-$(uname -r)

[root@host1 ~]# rpm -qa | grep debuginfo
kernel-debuginfo-common-x86_64-3.10.0-1160.el7.x86_64
kernel-debuginfo-3.10.0-1160.el7.x86_64
</code></pre>
<p>The devel package was not installed successfully since it’s not available in the existing CentOS repository. It might be fixed by adding the expected repository for yum installation. The devel package is required by SystemTap otherwise the following error is seen.</p>
<pre><code>[root@host1 ~]# stap -v -e &#39;probe vfs.read &#123;printf(&quot;read performed\n&quot;); exit()&#125;&#39;
Checking &quot;/lib/modules/3.10.0-1160.el7.x86_64/build/.config&quot; failed with error: No such file or directory
Incorrect version or missing kernel-devel package, use: yum install kernel-devel-3.10.0-1160.el7.x86_64
</code></pre>
<p>Here we just install it directly from the downloaded format as below.</p>
<pre><code>[root@host1 ~]# wget https://rpmfind.net/linux/centos/7.9.2009/os/x86_64/Packages/kernel-devel-3.10.0-1160.el7.x86_64.rpm

[root@host1 ~]# rpm -ivh kernel-devel-3.10.0-1160.el7.x86_64.rpm

[root@host1 ~]# rpm -qa | grep kernel | grep  3.10.0
kernel-devel-3.10.0-1160.el7.x86_64
kernel-tools-libs-3.10.0-1160.el7.x86_64
kernel-tools-3.10.0-1160.el7.x86_64
kernel-debuginfo-common-x86_64-3.10.0-1160.el7.x86_64
kernel-debuginfo-3.10.0-1160.el7.x86_64
kernel-headers-3.10.0-1160.59.1.el7.x86_64
kernel-3.10.0-1160.el7.x86_64
</code></pre>
<p>To verify the SystemTap setup again:</p>
<pre><code>[root@host1 ~]# stap -v -e &#39;probe vfs.read &#123;printf(&quot;read performed\n&quot;); exit()&#125;&#39;
Pass 1: parsed user script and 474 library scripts using 271960virt/69264res/3504shr/65852data kb, in 640usr/30sys/672real ms.
Pass 2: analyzed script: 1 probe, 1 function, 7 embeds, 0 globals using 439304virt/232180res/4884shr/233196data kb, in 2180usr/950sys/2977real ms.
Pass 3: translated to C into &quot;/tmp/stap6kYO8U/stap_cc0f60b74db3020f09599659b9758c89_2771_src.c&quot; using 439304virt/232436res/5140shr/233196data kb, in 10usr/50sys/67real ms.
Pass 4: compiled C into &quot;stap_cc0f60b74db3020f09599659b9758c89_2771.ko&quot; in 8040usr/1720sys/9477real ms.
Pass 5: starting run.
read performed
Pass 5: run completed in 30usr/90sys/442real ms.
</code></pre>
<h2 id="SystemTap-scripts"><a href="#SystemTap-scripts" class="headerlink" title="SystemTap scripts"></a>SystemTap scripts</h2><p>For the most part, SystemTap scripts are the foundation of each SystemTap session. SystemTap scripts instruct SystemTap on what type of information to collect, and what to do once that information is collected. SystemTap scripts are made up of two components: events and handlers. Once a SystemTap session is underway, SystemTap monitors the operating system for the specified events and executes the handlers as they occur.</p>
<p>SystemTap scripts allow insertion of the instrumentation code without recompilation of the code and allows more flexibility with regard to handlers. Events serve as the triggers for handlers to run; handlers can be specified to record specified data and print it in a certain manner.</p>
<p>SystemTap scripts use the .stp file extension and contains probes written in the following format:</p>
<pre><code>probe event &#123;statements&#125;
</code></pre>
<p>Systemtap allows you to write functions to factor out code to be used by a number of probes. Thus, rather than repeatedly writing the same series of statements in multiple probes, you can just place the instructions in a function, as in:</p>
<pre><code>function function_name(arguments)&#123;statements&#125;
probe event &#123;function_name(arguments)&#125;
</code></pre>
<p>The statements in function_name are executed when the probe for event executes. The arguments are optional values passed into the function.</p>
<h2 id="Running-SystemTap-Scripts"><a href="#Running-SystemTap-Scripts" class="headerlink" title="Running SystemTap Scripts"></a>Running SystemTap Scripts</h2><p>SystemTap scripts are run through the command stap. stap can run SystemTap scripts from the standard input or from a file.</p>
<p>We have seen how to run SystemTap from the standard input when we tried to verify the installation in previous section.</p>
<p>We can also run it from a file as below.</p>
<pre><code>[root@host1 ~]# cat runfromfile.stp
probe vfs.read &#123;
    printf(&quot;read performed\n&quot;);
    exit()
&#125;

[root@host1 ~]# stap runfromfile.stp
read performed
</code></pre>
<p>At this point, we know what is SystemTap and how to deploy it. We will explore more meaningful usage of it in future posts.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://sourceware.org/systemtap/SystemTap_Beginners_Guide/">https://sourceware.org/systemtap/SystemTap_Beginners_Guide&#x2F;</a></li>
<li><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/systemtap_beginners_guide/index#introduction">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux&#x2F;7&#x2F;html-single&#x2F;systemtap_beginners_guide&#x2F;index#introduction</a></li>
<li><a target="_blank" rel="noopener" href="https://pkgs.org/download/kernel">https://pkgs.org/download/kernel</a></li>
<li><a target="_blank" rel="noopener" href="https://pkgs.org/download/kernel-devel">https://pkgs.org/download/kernel-devel</a></li>
<li><a target="_blank" rel="noopener" href="https://linux.cc.iitk.ac.in/mirror/centos/elrepo/kernel/el7/x86_64/RPMS/">https://linux.cc.iitk.ac.in/mirror/centos/elrepo/kernel/el7/x86_64&#x2F;RPMS&#x2F;</a></li>
<li><a target="_blank" rel="noopener" href="https://rpmfind.net/linux/rpm2html/search.php?query=kernel-devel">https://rpmfind.net/linux/rpm2html/search.php?query=kernel-devel</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.flamingbytes.com/blog/using-ftrace-to-analyze-latency-of-the-kernel-module-function/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo/FlamingBytes-icon-64x64-1.png">
      <meta itemprop="name" content="relentlesstorm">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlamingBytes">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | FlamingBytes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/using-ftrace-to-analyze-latency-of-the-kernel-module-function/" class="post-title-link" itemprop="url">How to use ftrace to analyze latency of the kernel module function</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-14 07:00:00" itemprop="dateCreated datePublished" datetime="2022-07-14T07:00:00-07:00">2022-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-27 12:40:16" itemprop="dateModified" datetime="2024-01-27T12:40:16-08:00">2024-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/Performance/" itemprop="url" rel="index"><span itemprop="name">Performance</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>In this example, we study the latency of the function “nfsd_vfs_write” from kernel module “nfsd”.</p>
<h2 id="ftrace-configuration"><a href="#ftrace-configuration" class="headerlink" title="ftrace configuration"></a>ftrace configuration</h2><p>The following ftrace options are used in this example. There are 8 nfsd processes to be traced.</p>
<ul>
<li>current_tracer:  function_graph</li>
<li>pids: 3591 3592 3593 3594 3595 3596 3597 3598</li>
<li>filters: nfsd_vfs_write [nfsd]</li>
</ul>
<h2 id="ftrace-result"><a href="#ftrace-result" class="headerlink" title="ftrace result"></a>ftrace result</h2><p>From the following trace result, it helps understand the call time of the function “nfsd_vfs_write”. This can be very helpful if we need to analyze the function latency in the kernel module.</p>
<pre><code>$ cat ftrace.out | grep nfsd_vfs_write | grep &quot;nfsd_vfs_write \[nfsd\]();&quot; | head -5
  1)  ! 185.011 us  |  nfsd_vfs_write [nfsd]();
  2)  ! 161.237 us  |  nfsd_vfs_write [nfsd]();
  3)  ! 200.954 us  |  nfsd_vfs_write [nfsd]();
  4)  ! 255.285 us  |  nfsd_vfs_write [nfsd]();
  5)  ! 171.537 us  |  nfsd_vfs_write [nfsd]();
</code></pre>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.kernel.org/doc/Documentation/trace/ftrace.txt">https://www.kernel.org/doc/Documentation/trace/ftrace.txt</a></li>
<li><a target="_blank" rel="noopener" href="https://lwn.net/Articles/365835/">https://lwn.net/Articles/365835/</a></li>
<li><a target="_blank" rel="noopener" href="https://lwn.net/Articles/366796/">https://lwn.net/Articles/366796/</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.flamingbytes.com/blog/dynamically-tracing-with-user-defined-tracepoint-in-perf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo/FlamingBytes-icon-64x64-1.png">
      <meta itemprop="name" content="relentlesstorm">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlamingBytes">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | FlamingBytes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/dynamically-tracing-with-user-defined-tracepoint-in-perf/" class="post-title-link" itemprop="url">Dynamically tracing with user-defined tracepoint in perf</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-13 07:00:00" itemprop="dateCreated datePublished" datetime="2022-07-13T07:00:00-07:00">2022-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-22 11:28:20" itemprop="dateModified" datetime="2023-10-22T11:28:20-07:00">2023-10-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/Performance/" itemprop="url" rel="index"><span itemprop="name">Performance</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>In this post, we are going to explore how to use <a href="/blog/perf-the-official-linux-profiler/" title="Perf - The official Linux profiler">Perf - The official Linux profiler</a> for dynamic tracing with user-defined tracepoint. When we say dynamic tracing, the kernel event(function) to be traced is not predefined in perf. Instead, we add the tracepoint event manually.</p>
<p>We will study it based on a real world nfs write performance issue.  With the 4k sequential write from fio, the throughput is much lower with newer kernel(5.x) compared to older kernel(3.x). By profiling the system, it’s clear to see the call stack and samples of nfsd are very different for the two kernel versions.</p>
<p><img src="/images/nfsd_perf_issue.png" alt="Image"></p>
<h2 id="Add-tracepoint-in-perf"><a href="#Add-tracepoint-in-perf" class="headerlink" title="Add tracepoint in perf"></a>Add tracepoint in perf</h2><p>At first look, I want to add a tracepoint for the kernel function “nfsd_vfs_write” since it appears in the main code path of nfsd for both kernel versions. But perf complains the error of “out of .text” as below.</p>
<pre><code>[root@host1 ~]# perf probe --add nfsd_vfs_write 
nfsd_vfs_write is out of .text, skip it.
  Error: Failed to add events. Reason: No such file or directory (Code: -2)
</code></pre>
<p>By checking the exported kernel symbols from &#x2F;proc&#x2F;kallsyms, the symbol type is lowercase “t” for the function “nfsd_vfs_write”.</p>
<pre><code>[root@host1 ~]# cat /proc/kallsyms |  egrep -i -w &quot;nfsd_vfs_write&quot;
ffffffffc094fdd0 t nfsd_vfs_write	[nfsd] 

[root@host1 ~]# perf probe -F | egrep -i &quot;nfsd_vfs_write$&quot;
nfsd_vfs_write
</code></pre>
<p>Based on the manual page of nm, lowercase means it is local symbol. It’s likely that the local symbol can’t be added as probe event.</p>
<blockquote>
<p>The symbol type.</p>
<blockquote>
<p>If lowercase, the symbol is usually local; if uppercase, the symbol is global (external).</p>
<p>“T” “t” The symbol is in the text (code) section.</p>
</blockquote>
</blockquote>
<p>If we still want to trace and understand the overhead for the function “nfsd_vfs_write”, ftrace is a way to go.</p>
<p>In this post, we want to discuss how to add a probe event in perf. So we try a different function “vfs_fsync_range” whose type is global symbol.</p>
<p>With the following commands, the probe for “vfs_fsync_range” is added to perf.</p>
<pre><code>[root@host1 ~]# uname -r
3.10.0-1160.el7.x86_64
[root@host1 ~]# cat /proc/kallsyms | awk &#39;&#123;if($2==&quot;T&quot;)print&#125;&#39; | grep -i vfs_fsync_range
ffffffff960837a0 T vfs_fsync_range

[root@host1 ~]# perf list | grep probe

[root@host1 ~]# perf probe vfs_fsync_range
Added new event:
  probe:vfs_fsync_range (on vfs_fsync_range)

You can now use it in all perf tools, such as:

    perf record -e probe:vfs_fsync_range -aR sleep 1

[root@host1 ~]# perf list | grep probe
  probe:vfs_fsync_range                              [Tracepoint event]
</code></pre>
<h2 id="Trace-the-user-defined-probe-event"><a href="#Trace-the-user-defined-probe-event" class="headerlink" title="Trace the user-defined probe event"></a>Trace the user-defined probe event</h2><p>At this point, we had the tracepoint for the function “vfs_fsync_range” added in perf. We are able to sample the stack trace and check the function runtime from <strong>perf script</strong> output. This can be useful because without the dynamic tracing like this, we can’t identify the overhead(runtime) for the target function. The similar tracing can be done with ftrace. Here we just study how to use perf to dynamically add a tracepoint for sampling in perf. However, based on the experiments, ftrace seems more powerful when to identify the kernel function overhead compared to perf.</p>
<p>The following commands show how to record the stack traces for the target tracepoint and how to extract the call time from it. By comparing the function call time for the differnt kernels, we could identify the possible issue in nfsd call stack.</p>
<pre><code>[root@host1 ~]#  perf record -e probe:vfs_fsync_range -aR sleep 10
[ perf record: Woken up 57 times to write data ]
[ perf record: Captured and wrote 16.284 MB perf.data (233480 samples) ]

[root@host1 ~]# ls -la perf.data
-rw------- 1 root root 17120542 Jul 13 23:50 perf.data

[root@host1 ~]#  perf record -e probe:vfs_fsync_range -g -aR sleep 10
[ perf record: Woken up 146 times to write data ]
[ perf record: Captured and wrote 38.179 MB perf.data (248546 samples) ]

[root@host1 ~]# ls -la perf.data
-rw------- 1 root root 40079506 Jul 13 23:52 perf.data

[root@host1 ~]# perf report --stdio
# To display the perf.data header info, please use --header/--header-only options.
#
#
# Total Lost Samples: 0
#
# Samples: 248K of event &#39;probe:vfs_fsync_range&#39;
# Event count (approx.): 248546
#
# Children      Self  Trace output
# ........  ........  ..................
#
   100.00%   100.00%  (ffffffff960837a0)
            |
            ---ret_from_fork_nospec_end
               kthread
               nfsd
               svc_process
               svc_process_common
               nfsd_dispatch
               nfsd4_proc_compound
               nfsd4_write
               vfs_fsync_range

[root@host1 ~]# perf script
nfsd  3592 [025]   677.464643: probe:vfs_fsync_range: (ffffffff960837a0)
        ffffffff960837a1 vfs_fsync_range+0x1 ([kernel.kallsyms])
        ffffffffc07a0b0f nfsd4_write+0x1cf ([kernel.kallsyms])
        ffffffffc07a267d nfsd4_proc_compound+0x3dd ([kernel.kallsyms])
        ffffffffc078d810 nfsd_dispatch+0xe0 ([kernel.kallsyms])
        ffffffffc0f61850 svc_process_common+0x400 ([kernel.kallsyms])
        ffffffffc0f61d13 svc_process+0xf3 ([kernel.kallsyms])
        ffffffffc078d16f nfsd+0xdf ([kernel.kallsyms])
        ffffffff95ec5c21 kthread+0xd1 ([kernel.kallsyms])
        ffffffff96593df7 ret_from_fork_nospec_end+0x0 ([kernel.kallsyms])
&lt;...&gt;
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.flamingbytes.com/blog/tuned-dynamic-adaptive-system-tuning-daemon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo/FlamingBytes-icon-64x64-1.png">
      <meta itemprop="name" content="relentlesstorm">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlamingBytes">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | FlamingBytes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/tuned-dynamic-adaptive-system-tuning-daemon/" class="post-title-link" itemprop="url">tuned - dynamic adaptive system tuning daemon</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-12 07:00:00" itemprop="dateCreated datePublished" datetime="2022-07-12T07:00:00-07:00">2022-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-22 11:28:20" itemprop="dateModified" datetime="2023-10-22T11:28:20-07:00">2023-10-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/Performance/" itemprop="url" rel="index"><span itemprop="name">Performance</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>Tuned</p>
<blockquote>
<p>Tuned is a daemon that uses udev to monitor connected devices and statically and dynamically tunes system settings according to a selected profile. Tuned is distributed with a number of predefined profiles for common use cases like high throughput, low latency, or powersave. It is possible to modify the rules defined for each profile and customize how to tune a particular device. To revert all changes made to the system settings by a certain profile, you can either switch to another profile or deactivate the tuned service.</p>
</blockquote>
</blockquote>
<h2 id="Check-the-tuned-service-and-active-profile"><a href="#Check-the-tuned-service-and-active-profile" class="headerlink" title="Check the tuned service and active profile"></a>Check the tuned service and active profile</h2><pre><code>[root@host1 ~]# systemctl status tuned
● tuned.service - Dynamic System Tuning Daemon
   Loaded: loaded (/usr/lib/systemd/system/tuned.service; enabled; vendor preset: enabled)
   Active: active (running) since Tue 2022-07-12 04:52:53 UTC; 13h ago
     Docs: man:tuned(8)
           man:tuned.conf(5)
           man:tuned-adm(8)
 Main PID: 2592 (tuned)
    Tasks: 5
   Memory: 33.9M
   CGroup: /system.slice/tuned.service
           └─2592 /usr/bin/python2 -Es /usr/sbin/tuned -l -P

Jul 12 04:52:52 host1 systemd[1]: Starting Dynamic System Tuning Daemon...
Jul 12 04:52:53 host1 systemd[1]: Started Dynamic System Tuning Daemon.

[root@host1 ~]# tuned-adm list
Available profiles:
- balanced                    - General non-specialized tuned profile
- desktop                     - Optimize for the desktop use-case
- hpc-compute                 - Optimize for HPC compute workloads
- latency-performance         - Optimize for deterministic performance at the cost of increased power consumption
- network-latency             - Optimize for deterministic performance at the cost of increased power consumption, focused on low latency network performance
- network-throughput          - Optimize for streaming network throughput, generally only necessary on older CPUs or 40G+ networks
- powersave                   - Optimize for low power consumption
- throughput-performance      - Broadly applicable tuning that provides excellent performance across a variety of common server workloads
- virtual-guest               - Optimize for running inside a virtual guest
- virtual-host                - Optimize for running KVM guests
Current active profile: balanced

[root@host1 ~]# tuned-adm active
Current active profile: balanced

[root@host1 ~]# cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor | head
powersave
powersave
&lt;omitted..&gt;
</code></pre>
<h2 id="Change-the-tuned-profile"><a href="#Change-the-tuned-profile" class="headerlink" title="Change the tuned profile"></a>Change the tuned profile</h2><pre><code>[root@host1 ~]# tuned-adm profile throughput-performance

[root@host1 ~]# tuned-adm active
Current active profile: throughput-performance

[root@host1 ~]# cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
performance
performance
&lt;omitted..&gt;
</code></pre>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://linux.die.net/man/8/tuned">https://linux.die.net/man/8/tuned</a></li>
<li><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/performance_tuning_guide/chap-red_hat_enterprise_linux-performance_tuning_guide-tuned">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux&#x2F;7&#x2F;html&#x2F;performance_tuning_guide&#x2F;chap-red_hat_enterprise_linux-performance_tuning_guide-tuned</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.flamingbytes.com/blog/install-and-uninstall-debuginfo-package-on-centos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo/FlamingBytes-icon-64x64-1.png">
      <meta itemprop="name" content="relentlesstorm">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlamingBytes">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | FlamingBytes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/install-and-uninstall-debuginfo-package-on-centos/" class="post-title-link" itemprop="url">Install and uninstall debuginfo package on CentOS</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-11 07:00:00" itemprop="dateCreated datePublished" datetime="2022-07-11T07:00:00-07:00">2022-07-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-22 11:28:20" itemprop="dateModified" datetime="2023-10-22T11:28:20-07:00">2023-10-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Install-debuginfo-package"><a href="#Install-debuginfo-package" class="headerlink" title="Install debuginfo package"></a>Install debuginfo package</h2><p>On CentOS, we can install debuginfo package as below.</p>
<ul>
<li><p>Modify &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Debuginfo.repo by setting “enabled&#x3D;1”</p>
</li>
<li><p>Run “yum install kernel-debuginfo”</p>
<p>  [root@host1 ~]# uname -r<br>  3.10.0-1160.el7.x86_64</p>
<p>  [root@host1 ~]# vim &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Debuginfo.repo<br>  [base-debuginfo]<br>  name&#x3D;CentOS-7 - Debuginfo<br>  baseurl&#x3D;<a target="_blank" rel="noopener" href="http://debuginfo.centos.org/7/$basearch/">http://debuginfo.centos.org/7/$basearch/</a><br>  gpgcheck&#x3D;1<br>  gpgkey&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;pki&#x2F;rpm-gpg&#x2F;RPM-GPG-KEY-CentOS-Debug-7<br>  enabled&#x3D;1</p>
<p>  [root@host1 ~]# yum install kernel-debuginfo<br>  Installed:<br>kernel-debuginfo.x86_64 0:4.19.113-300.el7<br>  Dependency Installed:<br>kernel-debuginfo-common-x86_64.x86_64 0:4.19.113-300.el7<br>  [root@host1 ~]# rpm -qa | grep debuginfo<br>  kernel-debuginfo-4.19.113-300.el7.x86_64<br>  kernel-debuginfo-common-x86_64-4.19.113-300.el7.x86_64</p>
</li>
</ul>
<p>Notice that the installed kernel-debuginfo package version does not match with the kernel version. We can use the following commands to install the identical version as kernel.</p>
<pre><code>[root@host1 ~]# yum install -y kernel-devel-$(uname -r) \
kernel-debuginfo-$(uname -r) \
kernel-debuginfo-common-$(uname -m)-$(uname -r)

Installed:
  kernel-debuginfo.x86_64 0:3.10.0-1160.el7  kernel-debuginfo-common-x86_64.x86_64 0:3.10.0-1160.el7
</code></pre>
<h2 id="Remove-debuginfo-package"><a href="#Remove-debuginfo-package" class="headerlink" title="Remove debuginfo package"></a>Remove debuginfo package</h2><pre><code>[root@host1 ~]# rpm -qa | grep debuginfo
kernel-debuginfo-4.19.113-300.el7.x86_64
kernel-debuginfo-common-x86_64-4.19.113-300.el7.x86_64

[root@host1 ~]# yum remove kernel-debuginfo
[root@host1 ~]# yum remove kernel-debuginfo-common-x86_64-4.19.113-300.el7.x86_64

[root@host1 ~]# rpm -qa | grep debug
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.flamingbytes.com/blog/using-sar-to-understand-system-activity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo/FlamingBytes-icon-64x64-1.png">
      <meta itemprop="name" content="relentlesstorm">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlamingBytes">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | FlamingBytes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/using-sar-to-understand-system-activity/" class="post-title-link" itemprop="url">How to use sar to understand Linux system activity</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-06 07:00:00" itemprop="dateCreated datePublished" datetime="2022-07-06T07:00:00-07:00">2022-07-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-27 12:53:52" itemprop="dateModified" datetime="2024-01-27T12:53:52-08:00">2024-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="About-sadc-and-sar"><a href="#About-sadc-and-sar" class="headerlink" title="About sadc and sar"></a>About sadc and sar</h2><p>sadc is known as system activity data collector. It samples system data a specified number of times (count) at a specified interval measured in seconds (interval). It writes in binary format to the specified outfile or to standard output. The sadc command is intended to be used as a backend to the sar command. The sar command can be used to collect, report or save system activity information.</p>
<p>The following are examples for some of the often used options to understand system activity including CPU, Memory, Disk IO and network.</p>
<h2 id="Report-CPU-utilization"><a href="#Report-CPU-utilization" class="headerlink" title="Report CPU utilization"></a>Report CPU utilization</h2><p>The ALL keyword with “-u” indicates that all the CPU fields should be displayed.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@host1 ~]<span class="comment"># sar -u 1 2</span></span><br><span class="line">Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)</span><br><span class="line"></span><br><span class="line">06:47:11 PM     CPU     %user     %<span class="built_in">nice</span>   %system   %iowait    %steal     %idle</span><br><span class="line">06:47:12 PM     all      0.00      0.00      0.01      0.00      0.00     99.99</span><br><span class="line">06:47:13 PM     all      0.01      0.00      0.00      0.00      0.00     99.99</span><br><span class="line">Average:        all      0.01      0.00      0.01      0.00      0.00     99.99</span><br><span class="line"></span><br><span class="line">[root@host1 ~]<span class="comment"># sar -u ALL 1 2</span></span><br><span class="line">Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)</span><br><span class="line"></span><br><span class="line">06:47:16 PM     CPU      %usr     %<span class="built_in">nice</span>      %sys   %iowait    %steal      %irq     %soft    %guest    %gnice     %idle</span><br><span class="line">06:47:17 PM     all      0.02      0.00      0.02      0.00      0.00      0.00      0.00      0.00      0.00     99.96</span><br><span class="line">06:47:18 PM     all      0.00      0.00      0.01      0.00      0.00      0.00      0.00      0.00      0.00     99.99</span><br><span class="line">Average:        all      0.01      0.00      0.02      0.00      0.00      0.00      0.00      0.00      0.00     99.97</span><br></pre></td></tr></table></figure>

<h2 id="Report-memory-statistics"><a href="#Report-memory-statistics" class="headerlink" title="Report memory statistics"></a>Report memory statistics</h2><pre><code>[root@host1 ~]# sar -R 1 2
Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)

07:00:19 PM   frmpg/s   bufpg/s   campg/s
07:00:20 PM    -10.00      0.00      0.00
07:00:21 PM      8.00      0.00      0.00
Average:        -1.00      0.00      0.00
</code></pre>
<h2 id="Report-memory-utilization-statistics"><a href="#Report-memory-utilization-statistics" class="headerlink" title="Report memory utilization statistics"></a>Report memory utilization statistics</h2><pre><code>[root@host1 ~]# sar -r 1 2
Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)

06:47:59 PM kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty
06:48:00 PM 1052993760   3499308      0.33    155084    226796   1805324      0.17    343248    178520       184
06:48:01 PM 1052993776   3499292      0.33    155084    226796   1805324      0.17    343464    178520       184
Average:    1052993768   3499300      0.33    155084    226796   1805324      0.17    343356    178520       184
</code></pre>
<h2 id="Report-swap-space-utilization-statistics"><a href="#Report-swap-space-utilization-statistics" class="headerlink" title="Report swap space utilization statistics"></a>Report swap space utilization statistics</h2><pre><code>[root@host1 ~]# sar -S 1 2
Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)

06:47:25 PM kbswpfree kbswpused  %swpused  kbswpcad   %swpcad
06:47:26 PM   4194300         0      0.00         0      0.00
06:47:27 PM   4194300         0      0.00         0      0.00
Average:      4194300         0      0.00         0      0.00
</code></pre>
<h2 id="Report-swapping-statistics"><a href="#Report-swapping-statistics" class="headerlink" title="Report swapping statistics"></a>Report swapping statistics</h2><pre><code>[root@host1 ~]# sar -W 1 2
Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)

06:50:10 PM  pswpin/s pswpout/s
06:50:11 PM      0.00      0.00
06:50:12 PM      0.00      0.00
Average:         0.00      0.00
</code></pre>
<h2 id="Report-paging-statistics"><a href="#Report-paging-statistics" class="headerlink" title="Report paging statistics"></a>Report paging statistics</h2><pre><code>[root@host1 ~]# sar -B 1 2
Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)

06:51:29 PM  pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff
06:51:30 PM      0.00      0.00     22.00      0.00     48.00      0.00      0.00      0.00      0.00
06:51:31 PM      0.00      0.00     19.00      0.00     47.00      0.00      0.00      0.00      0.00
Average:         0.00      0.00     20.50      0.00     47.50      0.00      0.00      0.00      0.00
</code></pre>
<h2 id="Report-hugepages-utilization-statistics"><a href="#Report-hugepages-utilization-statistics" class="headerlink" title="Report hugepages utilization statistics"></a>Report hugepages utilization statistics</h2><pre><code>[root@host1 ~]# sar -H 1 2
Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)

06:54:34 PM kbhugfree kbhugused  %hugused
06:54:35 PM         0         0      0.00
06:54:36 PM         0         0      0.00
Average:            0         0      0.00
</code></pre>
<h2 id="Report-task-creation-and-system-switching-activity"><a href="#Report-task-creation-and-system-switching-activity" class="headerlink" title="Report task creation and system switching activity"></a>Report task creation and system switching activity</h2><pre><code>[root@host1 ~]# sar -w 1 2
Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)

06:50:34 PM    proc/s   cswch/s
06:50:35 PM      0.00    524.00
06:50:36 PM      0.00    721.00
Average:         0.00    622.50
</code></pre>
<h2 id="Report-I-O-and-transfer-rate-statistics"><a href="#Report-I-O-and-transfer-rate-statistics" class="headerlink" title="Report I&#x2F;O and transfer rate statistics"></a>Report I&#x2F;O and transfer rate statistics</h2><pre><code>[root@host1 ~]# sar -b 1 2
Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)

06:52:14 PM       tps      rtps      wtps   bread/s   bwrtn/s
06:52:15 PM      0.00      0.00      0.00      0.00      0.00
06:52:16 PM      0.00      0.00      0.00      0.00      0.00
Average:         0.00      0.00      0.00      0.00      0.00
</code></pre>
<h2 id="Report-activity-for-each-block-device"><a href="#Report-activity-for-each-block-device" class="headerlink" title="Report  activity for each block device"></a>Report  activity for each block device</h2><pre><code>[root@host1 ~]# sar -d 1 2
Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)

06:53:04 PM       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
06:53:05 PM  dev259-0      1.00      0.00      8.00      8.00      0.00      0.00      1.00      0.10
06:53:05 PM  dev259-4      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:05 PM  dev259-5      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:05 PM  dev259-6      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:05 PM  dev259-7      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:05 PM  dev259-8      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:05 PM  dev259-9      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:05 PM dev259-10      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:05 PM dev259-11      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:05 PM dev259-12      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:05 PM  dev253-0      1.00      0.00      8.00      8.00      0.00      0.00      1.00      0.10
06:53:05 PM  dev253-1      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

06:53:05 PM       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
06:53:06 PM  dev259-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:06 PM  dev259-4      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:06 PM  dev259-5      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:06 PM  dev259-6      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:06 PM  dev259-7      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:06 PM  dev259-8      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:06 PM  dev259-9      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:06 PM dev259-10      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:06 PM dev259-11      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:06 PM dev259-12      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:06 PM  dev253-0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:53:06 PM  dev253-1      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

Average:          DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util
Average:     dev259-0      0.50      0.00      4.00      8.00      0.00      0.00      1.00      0.05
Average:     dev259-4      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:     dev259-5      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:     dev259-6      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:     dev259-7      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:     dev259-8      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:     dev259-9      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:    dev259-10      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:    dev259-11      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:    dev259-12      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:     dev253-0      0.50      0.00      4.00      8.00      0.00      0.00      1.00      0.05
Average:     dev253-1      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
</code></pre>
<h2 id="Report-network-statistics"><a href="#Report-network-statistics" class="headerlink" title="Report network statistics"></a>Report network statistics</h2><pre><code>[root@host1 ~]# sar -n DEV 1 2
Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)

06:56:34 PM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
06:56:35 PM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:56:35 PM      eth0     15.00      1.00      0.89      0.14      0.00      0.00      0.00
06:56:35 PM      eth3      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:56:35 PM      eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:56:35 PM      eth2      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:56:35 PM   docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00

06:56:35 PM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
06:56:36 PM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:56:36 PM      eth0     16.00      1.00      0.94      0.74      0.00      0.00      0.00
06:56:36 PM      eth3      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:56:36 PM      eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:56:36 PM      eth2      0.00      0.00      0.00      0.00      0.00      0.00      0.00
06:56:36 PM   docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00

Average:        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s
Average:           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:         eth0     15.50      1.00      0.92      0.44      0.00      0.00      0.00
Average:         eth3      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:         eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:         eth2      0.00      0.00      0.00      0.00      0.00      0.00      0.00
Average:      docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00
</code></pre>
<h2 id="Save-and-extract-records-from-file"><a href="#Save-and-extract-records-from-file" class="headerlink" title="Save and extract records from file"></a>Save and extract records from file</h2><p>Save the readings in the file in binary form. Each reading is in a separate record. The default value of the filename parameter is the current daily data file,  the &#x2F;var&#x2F;log&#x2F;sa&#x2F;sadd file. The -o option is exclusive of the -f option.  All the data available from the kernel are saved in the file (in fact, sar calls its data collector sadc with the option “-S ALL”).</p>
<pre><code>[root@host1 ~]# sar -o sar.out.1.2

[root@host1 ~]# sar -f sar.out.1.2 -u
Linux 5.7.12-1.el7.elrepo.x86_64 (host1) 	07/06/2022 	_x86_64_	(96 CPU)

07:04:45 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle
07:04:46 PM     all      0.02      0.00      0.05      0.00      0.00     99.93
07:04:47 PM     all      0.06      0.00      0.11      0.00      0.00     99.82
Average:        all      0.04      0.00      0.08      0.00      0.00     99.87
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.flamingbytes.com/blog/using-nconnect-to-improve-nfs-performance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo/FlamingBytes-icon-64x64-1.png">
      <meta itemprop="name" content="relentlesstorm">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlamingBytes">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | FlamingBytes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/using-nconnect-to-improve-nfs-performance/" class="post-title-link" itemprop="url">How to tune nconnect to improve NFS performance</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-06-30 07:00:00" itemprop="dateCreated datePublished" datetime="2022-06-30T07:00:00-07:00">2022-06-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-01-27 12:45:48" itemprop="dateModified" datetime="2024-01-27T12:45:48-08:00">2024-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>The nfs mount option “nconnect&#x3D;n” exists in all Linux distributions with kernel 5.3 or higher. nconnect enables multiple TCP connections for a single NFS mount.</p>
<p>From the nfs <a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man5/nfs.5.html">manual page</a>:</p>
<blockquote>
<p>nconnect&#x3D;n</p>
<blockquote>
<p>When using a connection oriented protocol such as TCP, it may sometimes be advantageous to set up multiple connections between the client and server. For instance, if your clients and&#x2F;or servers are equipped with multiple network interface cards (NICs), using multiple connections to spread the load may improve overall performance.  In such cases, the nconnect option allows the user to specify the number of connections that should be established between the client and server up to a limit of 16.</p>
</blockquote>
</blockquote>
<p>The nconnect option can be easily added during nfs mount as the following command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mount -t nfs -o nconnect=16 nfs-server-hostname:/mnt/nfsshare /mnt/nfsmnt1 		</span><br></pre></td></tr></table></figure>

<p>The following is the 4k sequential write performance comparison by increasing nconnect to 16 over a single 10GbE link.</p>
<p><img src="/images/nconnect.png" alt="Image"></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.suse.com/support/kb/doc/?id=000019933">https://www.suse.com/support/kb/doc/?id=000019933</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/@emilypotyraj/use-nconnect-to-effortlessly-increase-nfs-performance-4ceb46c64089">https:&#x2F;&#x2F;medium.com&#x2F;@emilypotyraj&#x2F;use-nconnect-to-effortlessly-increase-nfs-performance-4ceb46c64089</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.flamingbytes.com/blog/how-to-setup-nfs-network-file-system-on-rhel-centos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo/FlamingBytes-icon-64x64-1.png">
      <meta itemprop="name" content="relentlesstorm">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlamingBytes">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | FlamingBytes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/how-to-setup-nfs-network-file-system-on-rhel-centos/" class="post-title-link" itemprop="url">How to setup NFS (Network File System) on RHEL/CentOS</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-06-29 07:00:00" itemprop="dateCreated datePublished" datetime="2022-06-29T07:00:00-07:00">2022-06-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-22 11:28:20" itemprop="dateModified" datetime="2023-10-22T11:28:20-07:00">2023-10-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>We need to install NFS packages on the NFS Server as well as on NFS Client machine. We can install it via “yum” for RHEL&#x2F;CentOS.</p>
<p>On the NFS server side, run the following commands to setup NFS server.</p>
<pre><code>$ systemctl status nfs
$ mkfs.ext4 /dev/nvme9n1
$ mkdir /mnt/nfsshare

$ vim /etc/exports
/mnt/nfsshare 10.10.10.1(rw,no_root_squash)

$ systemctl restart nfs
$ exportfs -s
/mnt/nfsshare  10.10.10.1(sync,wdelay,hide,no_subtree_check,sec=sys,rw,secure,no_root_squash,no_all_squash)
</code></pre>
<p>On the NFS client side, run the following command to mount the exported NFS share.</p>
<pre><code>$ mkdir /mnt/nfs1
$ mount -t nfs nfs-server-hostname:/mnt/nfsshare /mnt/
$ mount  | grep nfs1
fs-server-hostname:/mnt/nfsshare on /mnt/nfs1 type nfs4 (rw,relatime,vers=4.1,rsize=1048576,wsize=1048576,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=sys,clientaddr=10.10.10.2,local_lock=none,addr=10.10.10.1)
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.flamingbytes.com/blog/sysrq-linux-magic-system-request-key-hacks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo/FlamingBytes-icon-64x64-1.png">
      <meta itemprop="name" content="relentlesstorm">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlamingBytes">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | FlamingBytes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/sysrq-linux-magic-system-request-key-hacks/" class="post-title-link" itemprop="url">SysRq - Linux Magic System Request Key Hacks</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-21 07:00:00" itemprop="dateCreated datePublished" datetime="2022-05-21T07:00:00-07:00">2022-05-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-22 11:28:20" itemprop="dateModified" datetime="2023-10-22T11:28:20-07:00">2023-10-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="What-is-the-magic-SysRq-key"><a href="#What-is-the-magic-SysRq-key" class="headerlink" title="What is the magic SysRq key?"></a>What is the magic SysRq key?</h2><p>It is a ‘magical’ key combo you can hit which the kernel will respond to regardless of whatever else it is doing, unless it is completely locked up.</p>
<h2 id="How-do-I-enable-the-magic-SysRq-key"><a href="#How-do-I-enable-the-magic-SysRq-key" class="headerlink" title="How do I enable the magic SysRq key?"></a>How do I enable the magic SysRq key?</h2><p>You need to say “yes” to ‘Magic SysRq key (CONFIG_MAGIC_SYSRQ)’ when configuring the kernel. When running a kernel with SysRq compiled in, &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;sysrq controls the functions allowed to be invoked via the SysRq key. The default value in this file is set by the CONFIG_MAGIC_SYSRQ_DEFAULT_ENABLE config symbol, which itself defaults to 1. Here is the list of possible values in &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;sysrq:</p>
<ul>
<li><p>0 - disable sysrq completely</p>
</li>
<li><p>1 - enable all functions of sysrq</p>
</li>
<li><p>$&gt;$1 - bitmask of allowed sysrq functions (see below for detailed function description):</p>
<pre><code>2 =   0x2 - enable control of console logging level
4 =   0x4 - enable control of keyboard (SAK, unraw)
8 =   0x8 - enable debugging dumps of processes etc.
</code></pre>
<p>   16 &#x3D;  0x10 - enable sync command<br>   32 &#x3D;  0x20 - enable remount read-only<br>   64 &#x3D;  0x40 - enable signalling of processes (term, kill, oom-kill)<br>  128 &#x3D;  0x80 - allow reboot&#x2F;poweroff<br>  256 &#x3D; 0x100 - allow nicing of all RT tasks</p>
</li>
</ul>
<p>You can set the value in the file by the following command:</p>
<pre><code>$ echo &quot;number&quot; &gt;/proc/sys/kernel/sysrq
</code></pre>
<p>The number may be written here either as decimal or as hexadecimal with the 0x prefix. CONFIG_MAGIC_SYSRQ_DEFAULT_ENABLE must always be written in hexadecimal.</p>
<p>Note that the value of &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;sysrq influences only the invocation via a keyboard. Invocation of any operation via &#x2F;proc&#x2F;sysrq-trigger is always allowed (by a user with admin privileges).</p>
<h2 id="How-do-I-use-the-magic-SysRq-key"><a href="#How-do-I-use-the-magic-SysRq-key" class="headerlink" title="How do I use the magic SysRq key?"></a>How do I use the magic SysRq key?</h2><p>Write a character to &#x2F;proc&#x2F;sysrq-trigger. e.g.:</p>
<pre><code>$ echo &quot;command key&quot; &gt; /proc/sysrq-trigger
</code></pre>
<p>The “command key” is case sensitive.</p>
<h2 id="What-are-the-command-keys"><a href="#What-are-the-command-keys" class="headerlink" title="What are the command keys?"></a>What are the command keys?</h2><p><img src="/images/sysrq-command-key.png" alt="Image"></p>
<h2 id="What-can-I-use-them-for"><a href="#What-can-I-use-them-for" class="headerlink" title="What can I use them for?"></a>What can I use them for?</h2><p>If we want to check the backtrace of all active CPUs, we can do following.</p>
<pre><code>$ echo l &gt; /proc/sysrq-trigger


$ tail -f /var/log/messages
May 21 17:49:41 host1 kernel: sysrq: Show backtrace of all active CPUs
May 21 17:49:41 host1 kernel: NMI backtrace for cpu 34
May 21 17:49:41 host1 kernel: CPU: 34 PID: 27101 Comm: bash Tainted: G           O      5.7.12-1.el7.elrepo.x86_64 #1
May 21 17:49:41 host1 kernel: Hardware name: Supermicro SYS-1029U-TN12RV/X11DPU-V, BIOS 3.4 11/03/2020
May 21 17:49:41 host1 kernel: Call Trace:
May 21 17:49:41 host1 kernel: dump_stack+0x6d/0x9a
May 21 17:49:41 host1 kernel: ? lapic_can_unplug_cpu.cold+0x40/0x40
May 21 17:49:41 host1 kernel: nmi_cpu_backtrace.cold+0x14/0x53
May 21 17:49:41 host1 kernel: nmi_trigger_cpumask_backtrace+0xd9/0xdb
May 21 17:49:41 host1 kernel: arch_trigger_cpumask_backtrace+0x19/0x20
May 21 17:49:41 host1 kernel: sysrq_handle_showallcpus+0x17/0x20
May 21 17:49:41 host1 kernel: __handle_sysrq.cold+0x48/0x111
May 21 17:49:41 host1 kernel: write_sysrq_trigger+0x28/0x37
May 21 17:49:41 host1 kernel: proc_reg_write+0x66/0x90
May 21 17:49:41 host1 kernel: __vfs_write+0x1b/0x40
May 21 17:49:41 host1 kernel: vfs_write+0xb9/0x1b0
May 21 17:49:41 host1 kernel: ksys_write+0x67/0xe0
May 21 17:49:41 host1 kernel: __x64_sys_write+0x1a/0x20
May 21 17:49:41 host1 kernel: do_syscall_64+0x60/0x1e0
May 21 17:49:41 host1 kernel: entry_SYSCALL_64_after_hwframe+0x44/0xa9
&lt;...&gt;
</code></pre>
<p>The same message can also be checked from the following command.</p>
<pre><code>$ dmesg -T
$ journalctl --since &quot;5 minutes ago&quot;
</code></pre>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/latest/admin-guide/sysrq.html">https://www.kernel.org/doc/html/latest/admin-guide/sysrq.html</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.flamingbytes.com/blog/journalctl-query-the-systemd-journal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo/FlamingBytes-icon-64x64-1.png">
      <meta itemprop="name" content="relentlesstorm">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlamingBytes">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | FlamingBytes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/blog/journalctl-query-the-systemd-journal/" class="post-title-link" itemprop="url">journalctl - Query the systemd journal</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-20 07:00:00" itemprop="dateCreated datePublished" datetime="2022-05-20T07:00:00-07:00">2022-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-10-22 11:28:20" itemprop="dateModified" datetime="2023-10-22T11:28:20-07:00">2023-10-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tech/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>journalctl may be used to query the contents of the systemd journal as written by systemd-journald.service.</p>
<p>If called without parameters, it will show the full contents of the journal, starting with the oldest entry collected.</p>
<p>The following are some of the common used options:</p>
<ul>
<li>–no-full, –full, -l Ellipsize fields when they do not fit in available columns. The default is to show full fields, allowing them to wrap or be truncated by the pager, if one is used.</li>
<li>-f, –follow Show only the most recent journal entries, and continuously print new entries as they are appended to the journal.</li>
<li>-u, –unit&#x3D;UNIT or PATTERN Show messages for the specified systemd unit UNIT (such as a service unit), or for any of the units matched by PATTERN. This parameter can be specified multiple times.</li>
<li>-S, –since&#x3D;, -U, –until&#x3D; Start showing entries on or newer than the specified date, or on or older than the specified date, respectively.</li>
</ul>
<p>The following commands are to save the journal to a file or query it on the fly with the <em>-f</em> option.</p>
<pre><code>$ systemctl -a | grep ntpd.service
  ntpd.service  loaded    active   running   Network Time Service
$ journalctl -u ntpd &gt; ntpd.journal.out
$ tail ntpd.journal.out

$ journalctl -u ntpd* --since &quot;10 minutes ago&quot;

$ journalctl -lfu ntpd*
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/15/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/17/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">relentlesstorm</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
